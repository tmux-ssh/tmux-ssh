name: Test

on:
  push:
    branches: [master, main]
  pull_request:
    branches: [master, main]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install tmux
        run: sudo apt-get update && sudo apt-get install -y tmux

      - name: Make scripts executable
        run: chmod +x tmux-ssh test.sh

      - name: Start tmux server
        run: tmux start-server

      - name: Run tests
        run: ./test.sh

  shellcheck:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install shellcheck
        run: sudo apt-get update && sudo apt-get install -y shellcheck

      - name: Run shellcheck on tmux-ssh
        run: shellcheck tmux-ssh

      - name: Run shellcheck on test.sh
        run: shellcheck test.sh || true  # Allow warnings in test script
